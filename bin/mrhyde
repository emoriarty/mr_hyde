#!/usr/bin/env ruby

STDOUT.sync = true

$:.unshift File.join(File.dirname(__FILE__), *%w{ .. lib })

require 'mercenary'
require 'mr_hyde'

Mercenary.program(:mrhyde) do |p|
  p.version MrHyde::VERSION
  p.description "Mr. Hyde is a tool intended to manage as many blog as you want powered by Jekyll."
  p.syntax "mrhyde <subcommand>"

  p.command(:new) do |c|
    c.syntax "new <subcommand> "
    c.description "Creates a new Mr. Hyde site scaffold in path"

    c.command(:site) do |site|
      site.syntax "site <path>"
      site.description "Creates a new Mr. Hyde site"

      site.option "force", "--force", "Force creation even if PATH already exists"

      site.action do |args, options|
        MrHyde::Commands::New.process({ :type => :site, :args => args }, options)
      end
    end

    c.command(:blog) do |blog|
      blog.syntax "new name [name .. n]"
      blog.description "Creates a new Jekyll blog or blogs"

      blog.option "force", "--force", "Force creation even if PATH already exists"
      blog.option "blank", "--blank", "Creates scaffolding but with empty files"

      blog.action do |args, options|
        MrHyde::Commands::New.process({ :type => :blog, :args => args }, options)
      end
    end

    #c.action do |args, options|
    #  MrHyde::Commands::New.process args
    #end
  end
  

  p.command(:build) do |c|
    c.syntax "build [name|name, name, ...] "
    c.description "Build the named blog or blogs, by default if no name is indicated then all blog will be built"

    c.action do |args, options|
      MrHyde::Commands::New.process args
    end
  end
end
